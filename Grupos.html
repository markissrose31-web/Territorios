<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Grupos - Congregaci√≥n</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #f7f8fb;
      --panel: #ffffffcc;
      --panel-strong: #ffffffee;
      --text: #0f172a;
      --muted: #64748b;
      --border: rgba(15, 23, 42, 0.12);
      --shadow: 0 10px 24px rgba(2, 6, 23, 0.12);
      --brand1: #7c3aed; --brand2: #06b6d4;
      --brand: linear-gradient(90deg, var(--brand1), var(--brand2));
      --header-h: 64px;
    }
    [data-theme="dark"] {
      --bg: #0b1020;
      --panel: #101828cc;
      --panel-strong: #0f172acc;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --border: rgba(148, 163, 184, 0.15);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--text); background: var(--bg);
      background-image:
        radial-gradient(900px 500px at -20% -20%, #7c3aed22 0%, transparent 50%),
        radial-gradient(900px 500px at 120% 10%, #06b6d422 0%, transparent 50%);
    }

    header {
      position: sticky; top: 0; z-index: 20;
      backdrop-filter: saturate(140%) blur(8px);
      background: var(--panel);
      border-bottom: 1px solid var(--border);
    }
    .top {
      max-width: 1100px; margin: 0 auto; padding: 12px 16px;
      display: flex; gap: 12px; align-items: center; justify-content: space-between;
      min-height: var(--header-h);
    }
    .brand { display: flex; align-items: center; gap: 12px; }
    .logo { width: 34px; height: 34px; border-radius: 10px; background: var(--brand); box-shadow: var(--shadow); }
    .title { font-weight: 700; letter-spacing: .2px; line-height: 1.1; }
    .title span { background: var(--brand); -webkit-background-clip: text; background-clip: text; color: transparent; }
    .actions { display: flex; align-items: center; gap: 8px; }
    .btn, .link-btn {
      display: inline-flex; align-items: center; gap: 8px; cursor: pointer;
      padding: 8px 12px; border-radius: 10px; border: 1px solid var(--border);
      background: var(--panel-strong); color: var(--text); text-decoration: none;
    }

    .wrap { max-width: 1100px; margin: 0 auto; padding: 16px 16px 24px; }

    .grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 14px;
    }
    .card {
      border: 1px solid var(--border); border-radius: 14px; overflow: hidden; background: var(--panel);
      box-shadow: var(--shadow); display: flex; flex-direction: column;
    }
    .thumb {
      position: relative; overflow: hidden; background: #0b122010; border-bottom: 1px solid var(--border);
      aspect-ratio: 4 / 3;
      display: block;
    }
    .thumb img {
      width: 100%; height: 100%; object-fit: contain; display: block;
      image-rendering: auto;
    }
    .meta { padding: 10px; display: grid; gap: 8px; background: var(--panel-strong); }
    .name { font-weight: 600; line-height: 1.2; }
    .row { display: flex; gap: 8px; flex-wrap: wrap; }
    .row .btn { font-size: 14px; padding: 6px 10px; }

    .lightbox {
      position: fixed; inset: 0; z-index: 100; display: none;
      background: rgba(0,0,0,0.6); backdrop-filter: blur(2px);
    }
    .lightbox.open { display: grid; grid-template-rows: auto 1fr auto; }
    .lb-top, .lb-bottom {
      display: flex; align-items: center; justify-content: space-between; gap: 8px;
      padding: 10px; background: var(--panel); border-bottom: 1px solid var(--border);
    }
    .lb-bottom { border-top: 1px solid var(--border); border-bottom: none; }
    .lb-title { font-weight: 600; }
    .lb-canvas { position: relative; background: #111418; overflow: hidden; touch-action: none; }
    .lb-img {
      position: absolute; top: 0; left: 0; will-change: transform;
      user-select: none; -webkit-user-drag: none; max-width: none; max-height: none; transform-origin: 0 0;
    }

    @media (max-width: 640px) { .grid{grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));} }
  </style>
</head>
<body>
  <header>
    <div class="top">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">
          <div style="font-size: 14px; color: var(--muted); font-weight: 600;">Congregaci√≥n J√°uregui</div>
          <div style="font-size: 18px;"><span>Grupos</span></div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" id="themeBtn" title="Cambiar tema">üåì Tema</button>
        <a class="link-btn" href="index.html" title="Ver territorios">üó∫Ô∏è Territorios</a>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div id="grid" class="grid"></div>
    <div id="empty" style="display:none; margin-top: 12px; color: var(--muted);">No hay mapas.</div>
  </main>

  <!-- Visor -->
  <div id="lightbox" class="lightbox" aria-hidden="true">
    <div class="lb-top">
      <div class="lb-title" id="lbTitle">Mapa</div>
      <div class="lb-controls">
        <button class="btn" id="shareBtn" title="Copiar enlace">üîó Compartir</button>
        <a class="btn" id="downloadBtn" download title="Descargar">‚¨áÔ∏è Descargar</a>
        <button class="btn" id="closeBtn" title="Cerrar">‚úñÔ∏è</button>
      </div>
    </div>
    <div class="lb-canvas" id="lbCanvas">
      <img id="lbImg" class="lb-img" alt="Grupo" />
    </div>
    <div class="lb-bottom">
      <div class="lb-controls">
        <button class="btn" id="zoomOutBtn" title="Alejar">‚ûñ</button>
        <button class="btn" id="fitBtn" title="Ajustar a pantalla">üóñ</button>
        <button class="btn" id="zoomInBtn" title="Acercar">‚ûï</button>
      </div>
      <div class="lb-controls">
        <button class="btn" id="prevBtn" title="Anterior">‚¨ÖÔ∏è</button>
        <button class="btn" id="nextBtn" title="Siguiente">‚û°Ô∏è</button>
      </div>
    </div>
  </div>

  <script>
    const MAPS = [
      { src: 'maps/7.png',  name: 'Grupo 1' },
      { src: 'maps/8.png',  name: 'Grupo 2' },
      { src: 'maps/9.png',  name: 'Grupo 3' },
      { src: 'maps/10.png', name: 'Grupo 4' },
      { src: 'maps/11.png', name: 'Grupo 5' },
      { src: 'maps/12.png', name: 'Grupo 6' }
    ];

    const $ = (q) => document.querySelector(q);
    const $$ = (q) => Array.from(document.querySelectorAll(q));
    const slug = (s) => s.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
    const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
    const copy = (t) => navigator.clipboard?.writeText(t).catch(()=>{});
    const setTheme = (t) => { document.documentElement.setAttribute('data-theme', t); localStorage.setItem('theme', t); };
    setTheme(localStorage.getItem('theme') || 'light');
    $('#themeBtn').addEventListener('click', () => {
      const next = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      setTheme(next);
    });

    const grid = $('#grid'); const empty = $('#empty');
    function renderGrid() {
      grid.innerHTML = '';
      if (!MAPS.length) { empty.style.display = 'block'; return; }
      empty.style.display = 'none';
      MAPS.forEach((m, i) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.id = slug(m.name || m.src);
        card.innerHTML = `
          <div class="thumb"><img src="${m.src}" alt="${m.name}" loading="lazy" /></div>
          <div class="meta">
            <div class="name">${m.name}</div>
            <div class="row">
              <button class="btn" data-view="${i}">üëÅÔ∏è Ver</button>
              <a class="btn" href="${m.src}" download>‚¨áÔ∏è Descargar</a>
              <button class="btn" data-copy="${i}">üîó Copiar enlace</button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
      $$('.btn[data-view]').forEach(b => b.addEventListener('click', () => openViewer(+b.dataset.view)));
      $$('.btn[data-copy]').forEach(b => b.addEventListener('click', () => {
        const m = MAPS[+b.dataset.copy];
        const url = `${location.origin}${location.pathname}#m=${slug(m.name || m.src)}`;
        copy(url);
        b.textContent = '‚úÖ Copiado';
        setTimeout(()=> b.textContent = 'üîó Copiar enlace', 1200);
      }));
    }

    const lb = {
      el: $('#lightbox'), canvas: $('#lbCanvas'), img: $('#lbImg'),
      title: $('#lbTitle'), download: $('#downloadBtn'),
      idx: -1, scale: 1, tx: 0, ty: 0, min: 0.2, max: 8, dragging: false, lx: 0, ly: 0
    };
    function openViewer(index) {
      const m = MAPS[index]; if (!m) return;
      lb.idx = index; lb.img.src = m.src; lb.title.textContent = m.name || m.src; lb.download.href = m.src;
      lb.el.classList.add('open'); lb.el.setAttribute('aria-hidden', 'false');
      lb.img.onload = () => { fitToScreen(); history.replaceState(null, '', `#m=${slug(m.name || m.src)}`); };
    }
    function closeViewer() {
      lb.el.classList.remove('open'); lb.el.setAttribute('aria-hidden', 'true');
      if (location.hash.startsWith('#m=')) history.replaceState(null, '', location.pathname);
    }
    function fitToScreen() {
      const cw = lb.canvas.clientWidth, ch = lb.canvas.clientHeight;
      const iw = lb.img.naturalWidth, ih = lb.img.naturalHeight;
      const s = Math.min(cw / iw, ch / ih, 1);
      lb.scale = s; lb.tx = (cw - iw * s) / 2; lb.ty = (ch - ih * s) / 2; renderTransform();
    }
    function renderTransform() { lb.img.style.transform = `translate(${lb.tx}px, ${lb.ty}px) scale(${lb.scale})`; }
    function zoomAt(mx, my, factor) {
      const ns = clamp(lb.scale * factor, lb.min, lb.max); const ratio = ns / lb.scale;
      lb.tx = mx - (mx - lb.tx) * ratio; lb.ty = my - (my - lb.ty) * ratio; lb.scale = ns; renderTransform();
    }
    $('#closeBtn').addEventListener('click', closeViewer);
    $('#zoomInBtn').addEventListener('click', () => { const r = lb.canvas.getBoundingClientRect(); zoomAt(r.width/2, r.height/2, 1.2); });
    $('#zoomOutBtn').addEventListener('click', () => { const r = lb.canvas.getBoundingClientRect(); zoomAt(r.width/2, r.height/2, 1/1.2); });
    $('#fitBtn').addEventListener('click', fitToScreen);
    $('#prevBtn').addEventListener('click', () => openViewer((lb.idx - 1 + MAPS.length) % MAPS.length));
    $('#nextBtn').addEventListener('click', () => openViewer((lb.idx + 1) % MAPS.length));
    $('#shareBtn').addEventListener('click', () => {
      const m = MAPS[lb.idx]; const url = `${location.origin}${location.pathname}#m=${slug(m.name || m.src)}`;
      copy(url); const btn = $('#shareBtn'); const old = btn.textContent; btn.textContent = '‚úÖ Copiado'; setTimeout(()=> btn.textContent = old, 1200);
    });
    lb.canvas.addEventListener('wheel', (e) => {
      e.preventDefault(); const rect = lb.canvas.getBoundingClientRect();
      zoomAt(e.clientX - rect.left, e.clientY - rect.top, e.deltaY > 0 ? 0.9 : 1.1);
    }, { passive: false });
    lb.canvas.addEventListener('mousedown', (e) => { e.preventDefault(); lb.dragging = true; lb.lx = e.clientX; lb.ly = e.clientY; lb.canvas.style.cursor = 'grabbing'; });
    window.addEventListener('mouseup', () => { lb.dragging = false; lb.canvas.style.cursor = 'default'; });
    window.addEventListener('mousemove', (e) => { if (!lb.dragging) return; const dx = e.clientX - lb.lx, dy = e.clientY - lb.ly; lb.tx += dx; lb.ty += dy; lb.lx = e.clientX; lb.ly = e.clientY; renderTransform(); });
    lb.canvas.addEventListener('dblclick', (e) => { const rect = lb.canvas.getBoundingClientRect(); zoomAt(e.clientX - rect.left, e.clientY - rect.top, 1.4); });
    window.addEventListener('keydown', (e) => {
      if (!$('#lightbox').classList.contains('open')) return;
      if (e.key === 'Escape') closeViewer();
      if (e.key === 'ArrowRight') $('#nextBtn').click();
      if (e.key === 'ArrowLeft') $('#prevBtn').click();
      if (e.key === '+' || e.key === '=') $('#zoomInBtn').click();
      if (e.key === '-') $('#zoomOutBtn').click();
      if (e.key.toLowerCase() === 'f') $('#fitBtn').click();
    });

    function openFromHash() {
      const m = location.hash.match(/^#m=(.+)$/); if (!m) return;
      const id = m[1]; const idx = MAPS.findIndex(x => slug(x.name || x.src) === id);
      if (idx >= 0) openViewer(idx);
    }
    renderGrid(); openFromHash(); window.addEventListener('hashchange', openFromHash);
  </script>
</body>
</html>